# Система статистического анализа данных

Проект представляет собой комплексную систему для статистического анализа данных, построенную на микросервисной архитектуре. Система состоит из трех основных компонентов: фронтенд (Next.js), API-сервер (Go) и вычислительный сервер (Python).

## Архитектура системы

```
┌──────────────┐          ┌───────────┐          ┌────────────────┐
│              │  HTTP    │           │   gRPC   │                │
│   Frontend   │◄────────►│ Go Server │◄────────►│ Python Server  │
│  (Next.js)   │  REST    │ (API)     │ Protobuf │ (Analysis)     │
│              │          │           │          │                │
└──────────────┘          └───────────┘          └────────────────┘
                               ▲
                               │
                               ▼
                        ┌──────────────┐
                        │              │
                        │  PostgreSQL  │
                        │  (Database)  │
                        │              │
                        └──────────────┘
```

## Компоненты системы

### 1. Frontend (Next.js/React)

Интерактивный пользовательский интерфейс для работы с системой статистического анализа.

**Ключевые технологии:**
- Next.js 15 (React 19)
- TypeScript
- Tailwind CSS
- shadcn/ui (Radix UI)
- Recharts & D3.js

**Функциональность:**
- Загрузка файлов данных (CSV, Excel)
- Визуализация результатов анализа
- Управление историей анализов
- Аутентификация и авторизация

Фронтенд часть проекта реализована на базе современного стека технологий, предоставляя интерактивный интерфейс для статистического анализа данных.

#### Технологии

- **Next.js 15** - React-фреймворк с поддержкой серверного рендеринга и роутинга на базе файловой системы
- **React 19** - Библиотека для создания пользовательских интерфейсов
- **TypeScript** - Типизированный JavaScript для повышения надежности кода
- **Tailwind CSS** - Утилитарный CSS-фреймворк для быстрого стилизации компонентов
- **shadcn/ui** - Набор компонентов, построенных на Radix UI
- **Recharts & D3.js** - Библиотеки для визуализации данных
- **React Hook Form** - Управление формами с валидацией
- **Zod** - Библиотека для валидации схем данных

#### Структура проекта

```
frontend/
├── app/                   # Основная структура приложения (Next.js App Router)
│   ├── auth/              # Страницы аутентификации
│   ├── dashboard/         # Панель управления и анализа
│   │   ├── results/       # Результаты анализа
│   │   ├── settings/      # Настройки пользователя
│   │   └── upload/        # Загрузка данных для анализа
│   ├── globals.css        # Глобальные стили
│   └── layout.tsx         # Корневой макет приложения
├── components/            # Переиспользуемые компоненты
│   ├── charts/            # Компоненты визуализации данных
│   ├── ui/                # UI компоненты (shadcn/ui)
│   ├── dashboard-nav.tsx  # Навигация панели управления
│   └── language-provider.tsx # Провайдер для многоязычности
├── hooks/                 # Пользовательские React-хуки
├── lib/                   # Вспомогательные функции и утилиты
├── public/                # Статические файлы
└── styles/                # Стили компонентов
```

#### Ключевые особенности

1. **Визуализация данных** - графики для представления результатов анализа:
   - Гистограммы распределения
   - Графики регрессионных моделей
   - Таблицы
2. **Адаптивный дизайн** - полная поддержка мобильных и десктопных устройств
3. **Безопасность** - управление сессиями и токенами с автоматическим обновлением

#### Описательная статистика

Модуль описательной статистики предоставляет полный набор показателей для анализа данных:
- Основные меры центральной тенденции (среднее, медиана, мода)
- Меры разброса (стандартное отклонение, дисперсия)
- Минимальные и максимальные значения
- Доверительные интервалы
- Визуализация с помощью гистограмм распределения

#### Тесты нормальности

Приложение поддерживает проверку данных на нормальность распределения с помощью:
- Теста Шапиро-Уилка
- Теста Хи-квадрат (Пирсона)

#### Регрессионный анализ

Модуль регрессионного анализа позволяет исследовать зависимости между переменными с помощью различных моделей:
- Линейная
- Квадратичная
- Степенная
- Логарифмическая
- Тригонометрическая
- Сигмоидная

Каждая модель представлена соответствующим уравнением, визуализацией на графике и таблицей коэффициентов.

#### Запуск фронтенда

```bash
# Переход в директорию фронтенда
cd frontend

# Установка зависимостей
npm install

# Запуск в режиме разработки
npm run dev

# Сборка проекта
npm run build

# Запуск production-сборки
npm run start
```

Приложение будет доступно по адресу: `http://localhost:3000`

### 2. Go Server (API)

Промежуточный сервер, обеспечивающий REST API для фронтенда и взаимодействие с Python-сервером через gRPC.

**Ключевые технологии:**
- Go 1.23
- Gin (HTTP фреймворк)
- gRPC/Protocol Buffers
- PostgreSQL
- JWT

**Функциональность:**
- Аутентификация и авторизация пользователей
- Обработка загружаемых файлов
- Хранение и извлечение результатов анализа
- Связь между фронтендом и вычислительным ядром

Серверная часть проекта реализована на языке Go и выполняет роль промежуточного слоя между фронтендом и вычислительным Python-сервером.

#### Технологии Go-сервера

- **Go 1.23** - Современный, производительный язык программирования
- **Gin** - Быстрый HTTP фреймворк для построения REST API
- **gRPC** - Высокопроизводительный RPC фреймворк для межсервисного взаимодействия
- **Protocol Buffers** - Механизм сериализации структурированных данных
- **PostgreSQL** - Реляционная база данных для хранения пользователей и результатов анализа
- **JWT** - Механизм аутентификации и авторизации пользователей

#### Архитектура Go-сервера

Серверная часть построена на принципах чистой архитектуры с разделением на слои:

```
go-server/
├── cmd/                  # Точки входа в приложение
│   └── main.go           # Основной файл запуска сервера, инициализация компонентов и маршрутизации
├── generated/            # Сгенерированный gRPC код из proto-файлов
│   ├── analysis.pb.go    # Сгенерированные Protocol Buffers структуры данных
│   └── analysis_grpc.pb.go # Сгенерированный gRPC клиент и сервер
├── internal/             # Внутренние пакеты приложения
│   ├── adapter/          # Адаптеры для внешних сервисов
│   │   └── analysis_client.go # gRPC клиент для взаимодействия с Python-сервером
│   ├── common/           # Общие утилиты и константы
│   │   └── context_keys.go # Ключи для контекста (UserID и др.)
│   ├── database/         # Конфигурация и подключение к базе данных
│   │   └── database.go   # Инициализация и настройка соединения с PostgreSQL
│   ├── handlers/         # HTTP обработчики (контроллеры)
│   │   ├── analysis_handler.go # Обработчик запросов для анализа данных
│   │   └── auth_handler.go     # Обработчик запросов аутентификации и регистрации
│   ├── middleware/       # Промежуточные обработчики
│   │   └── auth_middleware.go  # Middleware для проверки JWT-токена и авторизации
│   ├── migrations/       # SQL миграции базы данных
│   │   ├── 000001_create_users_table.up.sql    # Миграция для создания таблицы пользователей
│   │   ├── 000001_create_users_table.down.sql  # Отмена миграции таблицы пользователей
│   │   ├── 000002_create_analysis_tables.up.sql   # Миграция для создания таблиц анализа
│   │   └── 000002_create_analysis_tables.down.sql # Отмена миграции таблиц анализа
│   ├── models/           # Модели данных
│   │   ├── user.go       # Модель пользователя
│   │   ├── analysis_run.go   # Модель запуска анализа (метаданные)
│   │   └── analysis_result_data.go # Модель результатов анализа
│   ├── repository/       # Слой доступа к данным
│   │   ├── user_repository.go # Интерфейс репозитория пользователей
│   │   ├── postgres_user_repository.go # Реализация репозитория пользователей для PostgreSQL
│   │   └── analysis_repository.go # Репозиторий для работы с данными анализа
│   ├── server/           # Конфигурация HTTP сервера
│   │   └── server.go     # Абстракция HTTP сервера с методами запуска и остановки
│   └── services/         # Бизнес-логика
│       ├── auth_service.go  # Интерфейс сервиса аутентификации
│       ├── auth_service_impl.go # Реализация сервиса аутентификации
│       ├── analysis_service.go  # Интерфейс сервиса анализа данных
│       └── analysis_service_impl.go # Реализация сервиса анализа данных
```

#### Основные функциональные модули Go-сервера

##### 1. Аутентификация и авторизация
- Регистрация и авторизация пользователей
- JWT токены для защиты API-эндпоинтов
- Механизм обновления токенов

##### 2. Анализ данных
- Загрузка CSV/Excel файлов
- Передача данных на Python-сервер через gRPC
- Хранение и извлечение результатов анализа

##### 3. История анализов
- Сохранение метаданных анализа
- Сохранение результатов анализа в формате JSONB
- API для получения истории и результатов анализа

#### API-эндпоинты

##### Публичные эндпоинты (без авторизации)
- `POST /api/auth/register` - Регистрация нового пользователя
- `POST /api/auth/login` - Авторизация пользователя и получение токенов
- `POST /api/auth/refresh` - Обновление токена доступа

##### Защищенные эндпоинты (требуют авторизации)
- `POST /api/analyze` - Отправка файла на анализ
- `POST /api/columns` - Получение списка колонок из файла
- `GET /api/analyses/history` - Получение истории анализов пользователя
- `GET /api/analyses/history/:runId/results` - Получение результатов конкретного анализа

#### База данных

Структура базы данных состоит из следующих таблиц:

##### 1. users - Хранение информации о пользователях
- id, email, password_hash, created_at, updated_at

##### 2. analysis_runs - Метаданные запусков анализа
- id, user_id, file_name, run_at, selected_analyses, dependent_variable, independent_variable

##### 3. analysis_results_data - Результаты анализа
- id, analysis_run_id, result_type, data (JSONB)

#### Межсервисное взаимодействие

Go-сервер взаимодействует с Python-сервером через gRPC протокол:

1. **Protocol Buffers** определяют структуру сообщений и сервисов в `proto/analysis.proto`
2. **gRPC клиент** в Go отправляет запросы на анализ данных Python-серверу
3. **Адаптер** преобразует данные между форматами Go и Protocol Buffers

#### Запуск Go-сервера

##### Предварительные требования
- Go 1.23 или выше
- PostgreSQL 15 или выше
- Docker и Docker Compose (опционально)

##### Шаги запуска

1. Запуск базы данных PostgreSQL:
```bash
docker-compose up -d postgres_db
```

2. Применение миграций:
```bash
make migrate-up
```

3. Генерация gRPC кода:
```bash
make generate-go
```

4. Запуск Go-сервера:
```bash
cd go-server
go run cmd/main.go
```

Сервер будет доступен по адресу: `http://localhost:8080`

#### Переменные окружения Go-сервера

- `GO_SERVER_PORT` - Порт HTTP сервера (по умолчанию: 8080)
- `PYTHON_SERVER_ADDR` - Адрес Python gRPC сервера (по умолчанию: localhost:9000)
- `JWT_SECRET_KEY` - Секретный ключ для JWT токенов
- `JWT_TOKEN_TTL_MINUTES` - Время жизни JWT токена в минутах (по умолчанию: 60)
- `DATABASE_URL` - URL подключения к PostgreSQL (по умолчанию: postgres://appuser:apppassword@localhost:5432/analysis_app_db)

### 3. Python Server (Analysis)

Вычислительное ядро системы, выполняющее статистический анализ данных.

**Ключевые технологии:**
- Python 3.8+
- gRPC/Protocol Buffers
- pandas, NumPy, SciPy, statsmodels

**Функциональность:**
- Описательная статистика
- Тесты на нормальность распределения
- Регрессионный анализ (различные модели)
- Доверительные интервалы

Вычислительный сервер на языке Python предоставляет мощные статистические алгоритмы для анализа данных, доступные через gRPC интерфейс. Сервер построен на принципах гексагональной архитектуры (порты и адаптеры), что обеспечивает четкое разделение ответственности и возможность тестирования компонентов изолированно.

#### Технологии Python-сервера

- **Python 3.8+** - Мощный язык программирования для обработки данных
- **gRPC** - Высокопроизводительный фреймворк для RPC (Remote Procedure Call)
- **Protocol Buffers** - Компактный механизм сериализации структурированных данных
- **pandas** - Библиотека для манипуляции данными и анализа
- **NumPy** - Библиотека для научных вычислений
- **SciPy** - Библиотека для статистических вычислений
- **statsmodels** - Библиотека для статистического моделирования

#### Архитектура Python-сервера

Сервер построен на принципах гексагональной архитектуры:

```
python-server/
├── analysis_modules/        # Модули статистического анализа
│   ├── descriptive.py       # Реализация алгоритмов описательной статистики (среднее, медиана, дисперсия)
│   ├── normality.py         # Реализация тестов на нормальность распределения (Шапиро-Уилк)
│   ├── confidence_interval.py # Вычисление доверительных интервалов для статистических показателей
│   ├── goodness_of_fit.py   # Реализация тестов хи-квадрат и оценки соответствия распределению
│   └── regression.py        # Реализация различных регрессионных моделей (линейная, квадратичная и др.)
├── internal/                # Внутренняя структура приложения
│   ├── adapters/            # Адаптеры для внешних систем (шаблон порты и адаптеры)
│   │   ├── __init__.py      # Инициализация пакета adapters
│   │   ├── data_loader.py   # Загрузка и парсинг данных из CSV и Excel файлов
│   │   ├── descriptive_stats.py # Адаптер для модуля описательной статистики
│   │   ├── normality_test.py    # Адаптер для модуля тестов на нормальность
│   │   ├── goodness_of_fit.py   # Адаптер для модуля тестов хи-квадрат
│   │   ├── confidence_interval.py # Адаптер для модуля доверительных интервалов
│   │   ├── regression.py    # Адаптер для модуля регрессионного анализа
│   │   └── grpc_server.py   # Реализация gRPC сервера, преобразование между Protobuf и доменными объектами
│   └── core/                # Ядро приложения (бизнес-логика)
│       ├── domain/          # Доменные модели и объекты
│       │   ├── __init__.py  # Инициализация пакета domain
│       │   └── entities.py  # Определение основных доменных сущностей (Dataset, AnalysisResult и т.д.)
│       ├── ports/           # Интерфейсы для взаимодействия между слоями
│       │   ├── __init__.py  # Инициализация пакета ports
│       │   └── analysis_ports.py # Интерфейсы для анализа данных (порты для адаптеров)
│       └── services/        # Реализация бизнес-логики
│           ├── __init__.py  # Инициализация пакета services
│           └── analysis_service.py # Основной сервис анализа данных, оркестрирует работу модулей
├── analysis_pb2.py          # Сгенерированные классы Protocol Buffers для структур данных
├── analysis_pb2_grpc.py     # Сгенерированные классы клиента и сервера gRPC
├── analysis_pb2.pyi         # Файл типизации для Protocol Buffers
├── main.py                  # Точка входа в приложение, настройка и запуск gRPC сервера
└── requirements.txt         # Список зависимостей Python-пакетов
```

#### Основные функциональные модули Python-сервера

##### 1. Описательная статистика
- Расчет базовых статистических показателей (среднее, медиана, мода)
- Вычисление мер разброса (дисперсия, стандартное отклонение)
- Анализ формы распределения (асимметрия, эксцесс)
- Построение гистограмм распределения
- Вычисление доверительных интервалов

##### 2. Тесты на нормальность распределения
- Тест Шапиро-Уилка для проверки нормальности
- Тест хи-квадрат (Пирсона) для оценки соответствия распределению

##### 3. Регрессионный анализ
- Линейная регрессия
- Квадратичная регрессия
- Степенная регрессия
- Экспоненциальная регрессия
- Логарифмическая регрессия
- Тригонометрическая регрессия
- Сигмоидная регрессия
- Оценка качества моделей (R², скорректированный R², F-статистика)

#### gRPC API

Сервер предоставляет следующие gRPC методы:

```proto
service AnalysisService {
    rpc AnalyzeData(AnalysisRequest) returns (AnalyzeDataResponse);
}
```

##### AnalysisRequest
- `file_content` - бинарное содержимое файла (CSV, Excel)
- `file_name` - имя загружаемого файла
- `selected_analyses` - список выбранных типов анализа

##### AnalyzeDataResponse
- `descriptive_stats` - результаты описательной статистики
- `normality_tests` - результаты тестов на нормальность
- `regression_analysis` - результаты регрессионного анализа
- `processing_log` - логи обработки данных
- `error` - информация об ошибках, если они возникли

#### Обработка данных

Сервер поддерживает следующие форматы данных:
- CSV файлы (разделители: запятая, табуляция, точка с запятой)
- Excel файлы (XLSX, XLS)

Процесс обработки:
1. Загрузка и валидация файла
2. Предварительная обработка данных (определение типов, обработка пропусков)
3. Выполнение выбранных типов анализа
4. Форматирование результатов в соответствии с протоколом
5. Возвращение структурированного ответа

#### Запуск Python-сервера

##### Предварительные требования
- Python 3.8 или выше
- pip (менеджер пакетов Python)
- virtualenv (опционально, для изоляции зависимостей)

##### Установка зависимостей
```bash
# Создание и активация виртуальной среды (опционально)
python -m venv venv
source venv/bin/activate  # На Linux/MacOS
# или
venv\Scripts\activate     # На Windows

# Установка зависимостей
pip install -r requirements.txt
```

##### Запуск сервера
```bash
python main.py
```

По умолчанию сервер запускается на порту 9000 и принимает соединения со всех интерфейсов.

#### Взаимодействие с другими компонентами

Python-сервер взаимодействует с Go-сервером через gRPC протокол:

1. Go-сервер отправляет запрос на анализ с файлом и параметрами
2. Python-сервер выполняет необходимые расчеты
3. Результаты возвращаются в структурированном виде через Protocol Buffers
4. Go-сервер преобразует полученные данные в формат для фронтенда

## Основные функции системы

### Описательная статистика
- Расчет базовых статистических показателей (среднее, медиана, мода)
- Вычисление мер разброса (дисперсия, стандартное отклонение)
- Визуализация распределения через гистограммы
- Доверительные интервалы

### Тесты нормальности
- Тест Шапиро-Уилка
- Тест Хи-квадрат (Пирсона)

### Регрессионный анализ
- Линейная регрессия
- Квадратичная регрессия
- Степенная регрессия
- Экспоненциальная регрессия
- Логарифмическая регрессия
- Тригонометрическая регрессия
- Сигмоидная регрессия
- Оценка качества моделей (R², скорректированный R², F-статистика)

## Запуск проекта

Для запуска всей системы необходимо запустить все три компонента и базу данных.

### 1. База данных (PostgreSQL)
```bash
docker-compose up -d postgres_db
```

### 2. Python-сервер
```bash
cd python-server
python -m venv venv
source venv/bin/activate  # На Linux/MacOS
pip install -r requirements.txt
python main.py
```

### 3. Go-сервер
```bash
cd go-server
make migrate-up  # Применение миграций к БД
make generate-go  # Генерация gRPC кода
go run cmd/main.go
```

### 4. Frontend
```bash
cd frontend
npm install
npm run dev
```

## Порты по умолчанию

- Frontend: http://localhost:3000
- Go Server (API): http://localhost:8080
- Python Server (gRPC): localhost:9000
- PostgreSQL: localhost:5432 
